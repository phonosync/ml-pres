<!--
Custom Title Slide Template for Company Policy Compliance
This template creates a title slide with:
- ZHAW logo (top-left)
- School of Engineering text (top-right) 
- Custom background image with dark blue bottom section
- Centered title with light blue background
- Author and date information positioned below title
-->

<section id="title-slide" data-background-color="#003366" 
data-menu-title="$if(title-slide-attributes.data-menu-title)$$title-slide-attributes.data-menu-title$$else$title$endif$" 
class="quarto-title-block center">

<!-- Hidden data containers for JavaScript to access -->
<div id="quarto-title-data" style="display: none;">$title$</div>
<div id="quarto-author-data" style="display: none;">$author$</div>
<div id="quarto-date-data" style="display: none;">$date$</div>
<div id="quarto-organisationalunit-data" style="display: none;">$organisationalunit$</div>

<style>
/* Minimal Title Slide Styling - Let RevealJS handle the background */


/* Remove white borders and ensure full coverage */
section#title-slide {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Remove borders from reveal containers when on title slide */
body:has(section#title-slide) .reveal {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

body:has(section#title-slide) .reveal .slides {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Hide default Quarto title slide elements that we'll replace */
section#title-slide .quarto-title,
section#title-slide .quarto-title-meta,
section#title-slide h1.title,
section#title-slide .title,
section#title-slide .subtitle,
section#title-slide .author,
section#title-slide .date,
section#title-slide h1.title + p,
section#title-slide .title + p,
section#title-slide .quarto-title-authors,
section#title-slide .quarto-title-author {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* Logo styling for custom title slide logo (JS-injected) */
.title-logo {
  position: fixed;
  top: 3vh;
  left: 2vw;
  width: 18vw;
  height: 13.5vh;
  background-image: url('/ressources/zhaw_rgb_logo_nacht.png');
  background-size: contain;
  background-repeat: no-repeat;
  background-position: left center;
  z-index: 10;
  box-shadow: none;
}

/* School text styling for custom school text (JS-injected) */
.school-text {
  position: fixed;
  top: 6vh;
  right: 2vw;
  text-align: right;
  background-color: transparent;
  padding: 0px 0px;
  border-radius: 8px;
  font-size: 1.8vw;
  font-weight: 600;
  font-family: "Source Sans Pro", Helvetica, sans-serif;
  color: #003366;
  z-index: 10;
  white-space: nowrap;
  box-shadow: none;
}

/* Title styling for custom title box (JS-injected) */
.custom-title {
  background-color: #87CEEB; /* Light blue */
  color: #003366; /* Dark blue text */
  padding: 2.5vh 4vw;
  border-radius: 8px;
  font-weight: bold;
  font-family: "Source Sans Pro", Helvetica, sans-serif;
  position: fixed;
  bottom: 25vh;
  left: 50%;
  transform: translateX(-50%);
  z-index: 50;
  text-align: left;
  max-width: 90vw;
  box-sizing: border-box;
  font-size: 5vw;
  min-height: auto;
}

/* Author/date box styling for custom author/date text (JS-injected) */
.author-date-box {
  position: fixed;
  bottom: 5vh;
  left: 50%;
  transform: translateX(-50%);
  background-color: transparent;
  color: white;
  padding: 2.5vh 4vw;
  border-radius: 8px;
  font-size: 2vw;
  font-weight: normal;
  font-family: "Source Sans Pro", Helvetica, sans-serif;
  z-index: 20;
  text-align: left;
  box-shadow: none;
  max-width: 90vw;
  line-height: 1.4;
  text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
}

/* Ensure text content is positioned correctly */
section#title-slide h1.title,
section#title-slide .title {
  text-align: left;
  max-width: 90vw;
  box-sizing: border-box;
}

/* Add proper padding for content slides (non-title slides) */
/* .reveal .slides section:not(#title-slide) {
  padding: 20px !important;
}
*/

/* Ensure content slides have proper spacing */
.reveal .slides section:not(#title-slide) h1,
.reveal .slides section:not(#title-slide) h2,
.reveal .slides section:not(#title-slide) h3 {
  margin-top: 0.5em !important;
  margin-bottom: 0.5em !important;
}

.reveal .slides section:not(#title-slide) p,
.reveal .slides section:not(#title-slide) ul,
.reveal .slides section:not(#title-slide) ol {
  margin-bottom: 1em !important;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let customElements = []; // Array to track our custom elements
    function setupTitleSlide() {
      let titleSlide = document.querySelector('section#title-slide');
    
      if (titleSlide && !titleSlide.querySelector('.custom-elements-added')) {
      

  // Always use absolute path for resources
  const resourcePath = '/ressources/';
      


      // Set background image directly on RevealJS background layer for the title slide
      function setRevealBackground() {
        const backgrounds = document.querySelectorAll('.reveal .backgrounds .slide-background');
        const currentSlide = document.querySelector('section.present');
        if (!backgrounds || !currentSlide) return;
        const isTitleSlide = currentSlide.id === 'title-slide';
        backgrounds.forEach(bg => {
          if (bg.classList.contains('present')) {
            if (isTitleSlide) {
              bg.style.backgroundImage = "url('/ressources/0101.svg')";
              bg.style.backgroundSize = '100% auto';
              bg.style.backgroundPosition = 'top left';
              bg.style.backgroundRepeat = 'no-repeat';
              bg.style.backgroundColor = '#003366';
            } else {
              bg.style.backgroundImage = '';
              bg.style.backgroundSize = '';
              bg.style.backgroundPosition = '';
              bg.style.backgroundRepeat = '';
              bg.style.backgroundColor = '';
            }
          }
        });
      }
      setTimeout(setRevealBackground, 300);
      if (window.Reveal && typeof Reveal.addEventListener === 'function') {
        Reveal.addEventListener('slidechanged', function(event) {
          setTimeout(setRevealBackground, 100);
        });
      }

  // Show debug overlay for troubleshooting
  // (debug overlay removed)
      
      // Check if we're currently on the title slide
      const currentSlide = document.querySelector('section.present');
      const isOnTitleSlide = currentSlide && currentSlide.id === 'title-slide';
      
      // Force remove borders and margins that might affect positioning
      document.body.style.margin = '0';
      document.body.style.padding = '0';
      document.body.style.border = 'none';
      document.body.style.outline = 'none';
      
      const reveal = document.querySelector('.reveal');
      const slides = document.querySelector('.reveal .slides');
      
      if (reveal) {
        reveal.style.border = 'none';
        reveal.style.outline = 'none';
        reveal.style.boxShadow = 'none';
        reveal.style.margin = '0';
        reveal.style.padding = '0';
      }
      
      if (slides) {
        slides.style.border = 'none';
        slides.style.outline = 'none';
        slides.style.boxShadow = 'none';
        slides.style.margin = '0';
        slides.style.padding = '0';
      }

      // Get title, author, date, and organizational unit information from hidden data containers
      let title = 'Title'; // fallback
      let date = '01.12.2025'; // fallback
      let author = 'Manuel DÃ¶mer'; // fallback
      let organisationalunit = ''; // fallback
      
      // Get from hidden data containers first
      const titleData = document.getElementById('quarto-title-data');
      const authorData = document.getElementById('quarto-author-data');
      const dateData = document.getElementById('quarto-date-data');
      const orgUnitData = document.getElementById('quarto-organisationalunit-data');
      
      if (titleData && titleData.textContent.trim()) {
        title = titleData.textContent.trim();
      }
      if (authorData && authorData.textContent.trim()) {
        author = authorData.textContent.trim();
      }
      if (dateData && dateData.textContent.trim()) {
        date = dateData.textContent.trim();
      }
      if (orgUnitData && orgUnitData.textContent.trim()) {
        organisationalunit = orgUnitData.textContent.trim();
      }
      
      // Try to get from meta tags as backup
      const metaTitle = document.querySelector('meta[property="og:title"]') || document.querySelector('title');
      const metaDate = document.querySelector('meta[name="date"]');
      const metaAuthor = document.querySelector('meta[name="author"]');
      
      if (metaTitle && metaTitle.textContent && (!titleData || !titleData.textContent.trim())) {
        title = metaTitle.textContent.trim();
      }
      if (metaDate && metaDate.getAttribute('content') && (!dateData || !dateData.textContent.trim())) {
        date = String(metaDate.getAttribute('content'));
      }
      if (metaAuthor && metaAuthor.getAttribute('content')) {
        author = metaAuthor.getAttribute('content');
      }

      console.log('Title:', title);
      console.log('Author:', author);
      console.log('Date:', date);
      console.log('Org Unit:', organisationalunit);

      // Create new custom title box with the actual title content
      const newTitle = document.createElement('div');
      newTitle.className = 'custom-title custom-element';
      newTitle.textContent = title; // Use the extracted title
      document.body.appendChild(newTitle);
      customElements.push(newTitle); // Track this element
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        newTitle.style.display = 'none';
      }

      // Add marker to prevent duplicate processing
      const marker = document.createElement('div');
      marker.className = 'custom-elements-added';
      marker.style.display = 'none';
      titleSlide.appendChild(marker);

      // Add ZHAW logo (top-left) - positioned relative to viewport
      const logo = document.createElement('div');
      logo.className = 'title-logo custom-element';

      document.body.appendChild(logo); // Attach to body instead of titleSlide
  customElements.push(logo); // Track this element
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        logo.style.display = 'none';
      }

      // Add school text (top-right)
      const schoolText = document.createElement('div');
      schoolText.className = 'school-text custom-element';
      schoolText.textContent = 'School of Engineering';
      document.body.appendChild(schoolText); // Attach to body instead of titleSlide
  customElements.push(schoolText); // Track this element
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        schoolText.style.display = 'none';
      }

      // Add author/date box positioned below title
      const authorDateBox = document.createElement('div');
      authorDateBox.className = 'author-date-box custom-element';
      
      // Format content with organizational unit on first line, date | author on second line
      let authorDateContent = '';
      if (organisationalunit) {
        authorDateContent = organisationalunit + '<br>';
      }
      authorDateContent += date + ' | ' + author;
      
      authorDateBox.innerHTML = authorDateContent;

      document.body.appendChild(authorDateBox); // Attach to body
  customElements.push(authorDateBox); // Track this element
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        authorDateBox.style.display = 'none';
      }

    }
  }

  // Function to remove background when leaving title slide
  function removeBackground() {
    const titleSlide = document.querySelector('section#title-slide');
    if (titleSlide) {
      // Remove any applied background styles when leaving title slide
      titleSlide.style.backgroundImage = '';
      titleSlide.style.backgroundColor = '';
    }
    
    // Clean up any duplicate markers
    const markers = document.querySelectorAll('.custom-elements-added');
    const marker = markers[markers.length - 1]; // Keep only the last one
    if (marker) {
      marker.remove();
    }
  }
  
  // Function to show custom title slide elements
  function showTitleSlideElements() {
    customElements.forEach((element, index) => {
      if (element && element.style) {
        element.style.display = 'block';
        element.style.visibility = 'visible';
      }
    });
  }
  
  // Function to hide custom title slide elements
  function hideTitleSlideElements() {
    customElements.forEach((element, index) => {
      if (element && element.style) {
        element.style.display = 'none';
        element.style.visibility = 'hidden';
      }
    });
  }

  // Setup title slide immediately
  setupTitleSlide();
  
  // Function to setup Reveal event listeners
  function setupRevealListeners() {
    if (window.Reveal && typeof Reveal.addEventListener === 'function') {
      Reveal.addEventListener('ready', function() {
        setupTitleSlide();
      });
      Reveal.addEventListener('slidechanged', function(event) {
        if (event.currentSlide && event.currentSlide.id === 'title-slide') {
          showTitleSlideElements();
        } else {
          hideTitleSlideElements();
          removeBackground();
        }
      });
      return true;
    }
    return false;
  }
  
  // Backup mechanism: periodically check if we need to show/hide elements
  function checkTitleSlideState() {
    const currentSlide = document.querySelector('section.present');
    const isOnTitleSlide = currentSlide && currentSlide.id === 'title-slide';
    
    if (isOnTitleSlide) {
      // Check if any elements are hidden when they should be visible
      let anyHidden = false;
      customElements.forEach(element => {
        if (element && element.style && 
            (element.style.display === 'none' || element.style.visibility === 'hidden')) {
          anyHidden = true;
        }
      });
      
      if (anyHidden) {
        showTitleSlideElements();
      }
    } else {
      // Check if any elements are visible when they should be hidden
      let anyVisible = false;
      customElements.forEach(element => {
        if (element && element.style && 
            element.style.display !== 'none' && element.style.visibility !== 'hidden') {
          anyVisible = true;
        }
      });
      
      if (anyVisible) {
        hideTitleSlideElements();
      }
    }
  }
  
  // Try to setup Reveal listeners immediately
  if (!setupRevealListeners()) {
    // If Reveal isn't ready, keep trying
    let attempts = 0;
    const maxAttempts = 20;
    const revealInterval = setInterval(function() {
      attempts++;
      if (setupRevealListeners() || attempts >= maxAttempts) {
        clearInterval(revealInterval);
        if (attempts >= maxAttempts) {
        }
      }
    }, 200);
  }
  
  // Start backup state checking after a delay to allow everything to initialize
  setTimeout(function() {
    setInterval(checkTitleSlideState, 1000); // Check every second
  }, 2000);
  
  // Also try to setup when the page is fully loaded
  window.addEventListener('load', function() {
    setTimeout(setupTitleSlide, 100);
  });
});
</script>

</section>