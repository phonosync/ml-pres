<!--
Custom Title Slide Template for Company Policy Compliance
This template creates a title slide with:
- ZHAW logo (top-left)
- School of Engineering text (top-right) 
- Custom background image with dark blue bottom section
- Centered title with light blue background
- Author and date information positioned below title
-->

<section id="title-slide" data-background-color="#003366" data-background-i      }
      return true;
    }
    return false;
  }

<style>
/* Minimal Title Slide Styling - Let RevealJS handle the background */

/* Remove white borders and ensure full coverage */
section#title-slide {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Remove borders from reveal containers when on title slide */
body:has(section#title-slide) .reveal {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

body:has(section#title-slide) .reveal .slides {
  border: none !important;
  outline: none !important;
  box-shadow: none !important;
  margin: 0 !important;
  padding: 0 !important;
}

/* Hide default Quarto elements on title slide only */
section#title-slide .author,
section#title-slide .date,
section#title-slide h1.title + p,
section#title-slide .title + p,
section#title-slide .quarto-title-authors,
section#title-slide .quarto-title-author {
  display: none !important;
  visibility: hidden !important;
  opacity: 0 !important;
}

/* Title styling with light blue background - title slide only */
section#title-slide h1.title,
section#title-slide .title {
  background-color: #87CEEB; /* Light blue */
  color: #003366; /* Dark blue text */
  padding: 25px 40px;
  border-radius: 12px;
  font-weight: bold;
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
  max-width: 80%;
  line-height: 1.2;
  z-index: 10;
  margin: 0;
  text-align: left;
  font-size: 3.5rem !important;
  height: auto;
  min-height: auto;
}
</style>

<h1 class="title">$title$</h1>

<!-- Hidden data containers for JavaScript to access -->
<div id="quarto-author-data" style="display: none;">$author$</div>
<div id="quarto-date-data" style="display: none;">$date$</div>
<div id="quarto-organisationalunit-data" style="display: none;">$organisationalunit$</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  let customElements = []; // Array to track our custom elements
  
  // Function to customize title slide - simplified approach
  function setupTitleSlide() {
    let titleSlide = document.querySelector('section#title-slide');
    
    console.log('Looking for title slide:', titleSlide);
    
    if (titleSlide && !titleSlide.querySelector('.custom-elements-added')) {
      console.log('Title slide found, adding custom elements');
      console.log('Title slide dimensions:', titleSlide.getBoundingClientRect());
      console.log('Viewport dimensions:', window.innerWidth, 'x', window.innerHeight);
      
      // Check if we're currently on the title slide
      const currentSlide = document.querySelector('section.present');
      const isOnTitleSlide = currentSlide && currentSlide.id === 'title-slide';
      
      // Force remove borders and margins that might affect positioning
      document.body.style.margin = '0';
      document.body.style.padding = '0';
      document.body.style.border = 'none';
      document.body.style.outline = 'none';
      
      const reveal = document.querySelector('.reveal');
      const slides = document.querySelector('.reveal .slides');
      
      if (reveal) {
        reveal.style.border = 'none';
        reveal.style.outline = 'none';
        reveal.style.boxShadow = 'none';
        reveal.style.margin = '0';
        reveal.style.padding = '0';
      }
      
      if (slides) {
        slides.style.border = 'none';
        slides.style.outline = 'none';
        slides.style.boxShadow = 'none';
        slides.style.margin = '0';
        slides.style.padding = '0';
      }
      
      // Hide the original title and create a new one positioned correctly
      const originalTitle = titleSlide.querySelector('h1.title, .title');
      let titleText = 'Title not found';
      
      if (originalTitle) {
        titleText = originalTitle.innerHTML || originalTitle.textContent || originalTitle.innerText;
        originalTitle.style.display = 'none'; // Hide original
        console.log('Original title found and hidden:', titleText);
      } else {
        console.log('Original title not found, using fallback');
      }
      
      // Create new title element positioned at bottom
      const newTitle = document.createElement('div');
      newTitle.className = 'custom-title custom-element';
      newTitle.innerHTML = titleText;
      newTitle.style.cssText = `
        background-color: #87CEEB !important;
        color: #003366 !important;
        padding: 25px 40px !important;
        border-radius: 12px !important;
        font-weight: bold !important;
        position: fixed !important;
        bottom: 250px !important;
        left: 240px !important;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2) !important;
        max-width: calc(100vw - 120px) !important;
        line-height: 1.2 !important;
        z-index: 15 !important;
        margin: 0 !important;
        text-align: left !important;
        font-size: 3.5rem !important;
        height: auto !important;
        min-height: auto !important;
      `;
      
      document.body.appendChild(newTitle);
      customElements.push(newTitle); // Track this element
      console.log('Added newTitle to customElements, array length now:', customElements.length);
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        newTitle.style.display = 'none';
        console.log('newTitle hidden because not on title slide');
      } else {
        console.log('newTitle visible because on title slide');
      }
      
      console.log('New title created at bottom:', newTitle.getBoundingClientRect());
      
      // Add marker to prevent duplicate processing
      const marker = document.createElement('div');
      marker.className = 'custom-elements-added';
      marker.style.display = 'none';
      titleSlide.appendChild(marker);
      
      // Add ZHAW logo (top-left) - positioned relative to viewport
      const logo = document.createElement('div');
      logo.className = 'title-logo custom-element';
      logo.style.cssText = `
        position: fixed;
        top: 30px;
        left: 30px;
        width: 180px;
        height: 135px;
        background-image: url('../ressources/zhaw_rgb_logo_nacht.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        z-index: 50;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      `;
      document.body.appendChild(logo); // Attach to body instead of titleSlide
      customElements.push(logo); // Track this element
      console.log('Added logo to customElements, array length now:', customElements.length);
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        logo.style.display = 'none';
        console.log('logo hidden because not on title slide');
      } else {
        console.log('logo visible because on title slide');
      }
      
      // Add School of Engineering text (top-right) - positioned relative to viewport
      const schoolText = document.createElement('div');
      schoolText.className = 'school-text custom-element';
      schoolText.textContent = 'School of Engineering';
      schoolText.style.cssText = `
        position: fixed;
        top: 60px;
        right: 30px;
        text-align: right;
        background-color: transparent;
        padding: 0px 0px;
        border-radius: 8px;
        font-size: 1.5rem;
        font-weight: 600;
        color: #003366;
        z-index: 50;
        white-space: nowrap;
        box-shadow: None;
      `;
      document.body.appendChild(schoolText); // Attach to body instead of titleSlide
      customElements.push(schoolText); // Track this element
      console.log('Added schoolText to customElements, array length now:', customElements.length);
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        schoolText.style.display = 'none';
        console.log('schoolText hidden because not on title slide');
      } else {
        console.log('schoolText visible because on title slide');
      }
      
      // Get author, date, and organizational unit information from hidden data containers
      let date = '01.12.2025'; // fallback
      let author = 'Manuel DÃ¶mer'; // fallback
      let organisationalunit = ''; // fallback
      
      // Get from hidden data containers first
      const authorData = document.getElementById('quarto-author-data');
      const dateData = document.getElementById('quarto-date-data');
      const orgUnitData = document.getElementById('quarto-organisationalunit-data');
      
      if (authorData && authorData.textContent.trim()) {
        author = authorData.textContent.trim();
      }
      if (dateData && dateData.textContent.trim()) {
        date = dateData.textContent.trim();
      }
      if (orgUnitData && orgUnitData.textContent.trim()) {
        organisationalunit = orgUnitData.textContent.trim();
      }
      
      // Try to get from meta tags as backup
      const metaDate = document.querySelector('meta[name="date"]');
      const metaAuthor = document.querySelector('meta[name="author"]');
      
      if (metaDate && metaDate.getAttribute('content') && (!dateData || !dateData.textContent.trim())) {
        date = String(metaDate.getAttribute('content'));
      }
      if (metaAuthor && metaAuthor.getAttribute('content')) {
        author = metaAuthor.getAttribute('content');
      }
      
      // Add author/date box positioned below title
      const authorDateBox = document.createElement('div');
      authorDateBox.className = 'author-date-box custom-element';
      
      // Build content with organizational unit as first line if it exists
      let content = '';
      if (organisationalunit) {
        content = organisationalunit + '<br>' + date + ' | ' + author;
      } else {
        content = date + ' | ' + author;
      }
      authorDateBox.innerHTML = content;
      
      // Initially position with fixed positioning - will be repositioned after title is measured
      authorDateBox.style.cssText = `
        position: fixed;
        left: 240px;
        background-color: transparent;
        padding: 15px 40px;
        color: white;
        font-size: 1.5rem;
        line-height: 1.4;
        text-align: left;
        z-index: 20;
        width: auto;
        box-sizing: border-box;
        height: auto;
        min-height: auto;
      `;
      
      document.body.appendChild(authorDateBox); // Attach to body
      customElements.push(authorDateBox); // Track this element
      console.log('Added authorDateBox to customElements, array length now:', customElements.length);
      
      // Hide if not on title slide
      if (!isOnTitleSlide) {
        authorDateBox.style.display = 'none';
        console.log('authorDateBox hidden because not on title slide');
      } else {
        console.log('authorDateBox visible because on title slide');
      }
      
      // Set width to match title and position below title box after a short delay
      setTimeout(() => {
        const titleElement = document.querySelector('.custom-title');
        if (titleElement) {
          const titleRect = titleElement.getBoundingClientRect();
          
          if (titleRect.width > 0) {
            console.log('Custom title width measured:', titleRect.width);
            console.log('Custom title bottom position:', titleRect.bottom);
            
            // Set width and left position to match title
            authorDateBox.style.width = titleRect.width + 'px';
            authorDateBox.style.left = '240px'; // Same as title
            
            // Position below title box with 20px gap
            const authorBoxTop = titleRect.bottom + 20;
            authorDateBox.style.top = authorBoxTop + 'px';
            authorDateBox.style.bottom = 'auto'; // Remove bottom positioning
          }
        }
      }, 500); // Increased delay to ensure custom title is created
      
      console.log('Custom title slide elements added');
    }
  }
  
  // Function to clean up when leaving title slide
  function removeBackground() {
    // Remove any custom elements attached to body
    const elementsToRemove = document.querySelectorAll('.custom-element');
    elementsToRemove.forEach(el => el.remove());
    
    // Remove the marker so elements can be recreated when returning to title slide
    const marker = document.querySelector('.custom-elements-added');
    if (marker) {
      marker.remove();
    }
  }
  
  // Function to show custom title slide elements
  function showTitleSlideElements() {
    console.log('showTitleSlideElements called, customElements array length:', customElements.length);
    customElements.forEach((element, index) => {
      if (element && element.style) {
        element.style.display = 'block';
        element.style.visibility = 'visible';
        console.log('Showing element', index, element.className);
      }
    });
    console.log('Showing title slide elements');
  }
  
  // Function to hide custom title slide elements
  function hideTitleSlideElements() {
    console.log('hideTitleSlideElements called, customElements array length:', customElements.length);
    customElements.forEach((element, index) => {
      if (element && element.style) {
        element.style.display = 'none';
        element.style.visibility = 'hidden';
        console.log('Hiding element', index, element.className);
      }
    });
    console.log('Hiding title slide elements');
  }
  
  // Setup title slide immediately
  setupTitleSlide();
  
  // Function to setup Reveal event listeners
  function setupRevealListeners() {
    if (window.Reveal && typeof Reveal.addEventListener === 'function') {
      console.log('Setting up Reveal event listeners');
      Reveal.addEventListener('ready', function() {
        console.log('Reveal ready, setting up slide detection');
        setupTitleSlide();
      });
      Reveal.addEventListener('slidechanged', function(event) {
        console.log('Slide changed to:', event.currentSlide ? event.currentSlide.id : 'unknown');
        console.log('Current slide element:', event.currentSlide);
        if (event.currentSlide && event.currentSlide.id === 'title-slide') {
          console.log('Switched to title slide, showing elements');
          showTitleSlideElements();
        } else {
          console.log('Left title slide, hiding elements');
          hideTitleSlideElements();
          removeBackground();
        }
      });
      return true;
    }
    return false;
  }
  
  // Backup mechanism: periodically check if we need to show/hide elements
  function checkTitleSlideState() {
    const currentSlide = document.querySelector('section.present');
    const isOnTitleSlide = currentSlide && currentSlide.id === 'title-slide';
    
    if (isOnTitleSlide) {
      // Check if any elements are hidden when they should be visible
      let anyHidden = false;
      customElements.forEach(element => {
        if (element && element.style && 
            (element.style.display === 'none' || element.style.visibility === 'hidden')) {
          anyHidden = true;
        }
      });
      
      if (anyHidden) {
        console.log('Title slide detected but elements hidden - showing them');
        showTitleSlideElements();
      }
    } else {
      // Check if any elements are visible when they should be hidden
      let anyVisible = false;
      customElements.forEach(element => {
        if (element && element.style && 
            element.style.display !== 'none' && element.style.visibility !== 'hidden') {
          anyVisible = true;
        }
      });
      
      if (anyVisible) {
        console.log('Not on title slide but elements visible - hiding them');
        hideTitleSlideElements();
      }
    }
  }
  
  // Try to setup Reveal listeners immediately
  if (!setupRevealListeners()) {
    // If Reveal isn't ready, keep trying
    let attempts = 0;
    const maxAttempts = 20;
    const revealInterval = setInterval(function() {
      attempts++;
      if (setupRevealListeners() || attempts >= maxAttempts) {
        clearInterval(revealInterval);
        if (attempts >= maxAttempts) {
          console.log('Could not setup Reveal listeners after', maxAttempts, 'attempts');
        }
      }
    }, 200);
  }
  
  // Start backup state checking after a delay to allow everything to initialize
  setTimeout(function() {
    console.log('Starting backup title slide state checking');
    setInterval(checkTitleSlideState, 1000); // Check every second
  }, 2000);
  
  // Also try to setup when the page is fully loaded
  window.addEventListener('load', function() {
    setTimeout(setupTitleSlide, 100);
    setTimeout(setupTitleSlide, 500);
  });
});
</script>

</section>